#include "sasm_opcodes.h"
#include "sasm_flags.h"

Error __AAA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __AAA\n");
    return ERR_OK;
}
Error __AAD(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __AAD\n");
    return ERR_OK;
}
Error __AAM(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __AAM\n");
    return ERR_OK;
}
Error __AAS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __AAS\n");
    return ERR_OK;
}
Error __CALL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CALL\n");
    return ERR_OK;
}
Error __CBW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CBW\n");
    return ERR_OK;
}
Error __CLD(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CLD\n");
    return ERR_OK;
}
Error __CLI(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CLI\n");
    return ERR_OK;
}
Error __CMP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CMP\n");
    return ERR_OK;
}
Error __CMPSB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CMPSB\n");
    return ERR_OK;
}
Error __CMPSW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CMPSW\n");
    return ERR_OK;
}
Error __CWD(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __CWD\n");
    return ERR_OK;
}
Error __DAA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __DAA\n");
    return ERR_OK;
}
Error __DAS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __DAS\n");
    return ERR_OK;
}
Error __DIV(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __DIV\n");
    return ERR_OK;
}
Error __IDIV(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __IDIV\n");
    return ERR_OK;
}
Error __IMUL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __IMUL\n");
    return ERR_OK;
}
Error __IN(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __IN\n");
    return ERR_OK;
}
Error __INC(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __INC\n");
    return ERR_OK;
}
Error __INT(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __INT\n");
    return ERR_OK;
}
Error __INTO(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __INTO\n");
    return ERR_OK;
}
Error __IRET(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __IRET\n");
    return ERR_OK;
}
Error __LAHF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LAHF\n");
    return ERR_OK;
}
Error __LDS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LDS\n");
    return ERR_OK;
}
Error __LEA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LEA\n");
    return ERR_OK;
}
Error __LES(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LES\n");
    return ERR_OK;
}
Error __LODSB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LODSB\n");
    return ERR_OK;
}
Error __LODSW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LODSW\n");
    return ERR_OK;
}
Error __LOOP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LOOP\n");
    return ERR_OK;
}
Error __LOOPE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LOOPE\n");
    return ERR_OK;
}
Error __LOOPNE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LOOPNE\n");
    return ERR_OK;
}
Error __LOOPNZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LOOPNZ\n");
    return ERR_OK;
}
Error __LOOPZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __LOOPZ\n");
    return ERR_OK;
}
Error __MOVSB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __MOVSB\n");
    return ERR_OK;
}
Error __MOVSW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __MOVSW\n");
    return ERR_OK;
}
Error __MUL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __MUL\n");
    return ERR_OK;
}
Error __NOT(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __NOT\n");
    return ERR_OK;
}
Error __OR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __OR\n");
    return ERR_OK;
}
Error __OUT(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __OUT\n");
    return ERR_OK;
}
Error __POP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __POP\n");
    return ERR_OK;
}
Error __POPA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __POPA\n");
    return ERR_OK;
}
Error __POPF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __POPF\n");
    return ERR_OK;
}
Error __PUSH(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __PUSH\n");
    return ERR_OK;
}
Error __PUSHA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __PUSHA\n");
    return ERR_OK;
}
Error __PUSHF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __PUSHF\n");
    return ERR_OK;
}
Error __RCL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __RCL\n");
    return ERR_OK;
}
Error __RCR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __RCR\n");
    return ERR_OK;
}
Error __REP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __REP\n");
    return ERR_OK;
}
Error __REPE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __REPE\n");
    return ERR_OK;
}
Error __REPNE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __REPNE\n");
    return ERR_OK;
}
Error __REPNZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __REPNZ\n");
    return ERR_OK;
}
Error __REPZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __REPZ\n");
    return ERR_OK;
}
Error __RET(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __RET\n");
    return ERR_OK;
}
Error __RETF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __RETF\n");
    return ERR_OK;
}
Error __ROL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __ROL\n");
    return ERR_OK;
}
Error __ROR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __ROR\n");
    return ERR_OK;
}
Error __SAHF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SAHF\n");
    return ERR_OK;
}
Error __SAL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SAL\n");
    return ERR_OK;
}
Error __SAR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SAR\n");
    return ERR_OK;
}
Error __SBB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SBB\n");
    return ERR_OK;
}
Error __SCASB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SCASB\n");
    return ERR_OK;
}
Error __SCASW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SCASW\n");
    return ERR_OK;
}
Error __SHL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SHL\n");
    return ERR_OK;
}
Error __SHR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SHR\n");
    return ERR_OK;
}
Error __STC(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __STC\n");
    return ERR_OK;
}
Error __STD(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __STD\n");
    return ERR_OK;
}
Error __STI(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __STI\n");
    return ERR_OK;
}
Error __STOSB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __STOSB\n");
    return ERR_OK;
}
Error __STOSW(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __STOSW\n");
    return ERR_OK;
}
Error __SUB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __SUB\n");
    return ERR_OK;
}
Error __TEST(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __TEST\n");
    return ERR_OK;
}
Error __XCHG(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __XCHG\n");
    return ERR_OK;
}
Error __XLATB(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __XLATB\n");
    return ERR_OK;
}
Error __XOR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __XOR\n");
    return ERR_OK;
}

Error __DONOP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nDO No OPeration\n");
    return ERR_OK;
}

Error __CLRCF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d", getFlag(CARRY, cpu));
    setFlag(CARRY, cpu, false);
    printf("\nAfter  : %d\n", getFlag(CARRY, cpu));
    return ERR_OK;
}

Error __TGLCF(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d", getFlag(CARRY, cpu));
    setFlag(CARRY, cpu, !getFlag(CARRY, cpu));
    printf("\nAfter  : %d\n", getFlag(CARRY, cpu));
    return ERR_OK;
}

Error __SHUTS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nSHUTing down System\n");
    setFlag(HALT, cpu, true);
    return ERR_OK;
}

Error __DECR(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d", *operand1);

    bool overflow = *operand1 == (-MAX_WORD);
    bool auxiliary = (((*operand1 & 0x0F) + (-1 & 0x0f)) > 0x0f);
    *operand1 = *operand1 + -1;

    setFlag(OVERFLOW, cpu, overflow);
    setFlag(ZERO, cpu, (*operand1 == 0));
    setFlag(SIGN, cpu, (*operand1 < 0));
    setFlag(AUX, cpu, auxiliary);
    checkAndSetParity(cpu, *operand1);

    printf("\nAfter  : %d\n", *operand1);
    return ERR_OK;
}

Error __NEG(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("CALLED __NEG\n");
    return ERR_OK;
}

Error __GOTO(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nUnconditional Jump to %d\n", *operand1);
    cpu->registers.IP = *operand1 - 1;
    return ERR_OK;
}

Error __JA(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(CARRY, cpu) && !getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JA / __JNBE \n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JNC(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(CARRY, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JAE / __JNB / __JNC\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JC(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(CARRY, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JB /__JNAE / __JC\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JBE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(CARRY, cpu) || getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JBE / __JNA\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JCXZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (cpu->registers.CX.full == 0) {
        printf("\nJUMPING TO %d\nREASON : __JCXZ\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JE / __JZ\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JG(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(SIGN, cpu) == getFlag(OVERFLOW, cpu) && !getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JG / __JNLE\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JGE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(SIGN, cpu) == getFlag(OVERFLOW, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JGE / __JNL\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JL(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(SIGN, cpu) != getFlag(OVERFLOW, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JL / __JNGE\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JLE(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(SIGN, cpu) != getFlag(OVERFLOW, cpu) || getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JLE / __JNG\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JNZ(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(ZERO, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JNE / __JNZ\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JNO(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(OVERFLOW, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JNO\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JNP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(PARITY, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JNP / __JPO\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JNS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (!getFlag(SIGN, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JNS\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JO(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(OVERFLOW, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JO\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JP(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(PARITY, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JP / __JPE\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __JS(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    if (getFlag(SIGN, cpu)) {
        printf("\nJUMPING TO %d\nREASON : __JS\n", *operand1);
        cpu->registers.IP = *operand1 - 1;
    }
    return ERR_OK;
}

Error __CPY(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d, %d", *operand1, *operand2);
    *operand1 = *operand2;
    printf("\nAfter  : %d\n", *operand1);
    return ERR_OK;
}

Error __ADC(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d, %d", *operand1, *operand2);

    bool overflow = (*operand2 > 0 && *operand1 > (MAX_WORD - *operand2));
    bool auxiliary = (((*operand1 & 0x0F) + (*operand2 & 0x0f)) > 0x0f);
    *operand1 = *operand1 + *operand2;
    *operand1 = *operand1 + (getFlag(CARRY, cpu) ? 1 : 0);

    setFlag(CARRY, cpu, overflow);
    setFlag(OVERFLOW, cpu, overflow);
    setFlag(ZERO, cpu, (*operand1 == 0));
    setFlag(SIGN, cpu, (*operand1 < 0));
    setFlag(AUX, cpu, auxiliary);
    checkAndSetParity(cpu, *operand1);

    printf("\nAfter  : %d\n", *operand1);
    return ERR_OK;
}

Error __ADD(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d, %d", *operand1, *operand2);

    bool overflow = (*operand2 > 0 && *operand1 > (MAX_WORD - *operand2));
    bool auxiliary = (((*operand1 & 0x0F) + (*operand2 & 0x0f)) > 0x0f);
    *operand1 = *operand1 + *operand2;

    setFlag(CARRY, cpu, overflow);
    setFlag(OVERFLOW, cpu, overflow);
    setFlag(ZERO, cpu, (*operand1 == 0));
    setFlag(SIGN, cpu, (*operand1 < 0));
    setFlag(AUX, cpu, auxiliary);
    checkAndSetParity(cpu, *operand1);

    printf("\nAfter  : %d\n", *operand1);
    return ERR_OK;
}

Error __AND(CPU* cpu, Memory* mem, Word* operand1, Word* operand2)
{
    printf("\nBefore : %d, %d", *operand1, *operand2);

    *operand1 = *operand1 & *operand2;

    setFlag(ZERO, cpu, (*operand1 == 0));
    setFlag(SIGN, cpu, (*operand1 < 0));
    checkAndSetParity(cpu, *operand1);

    printf("\nAfter  : %d\n", *operand1);
    return ERR_OK;
}
